---
title: ä½¿ç”¨ Google Cloud æ­å»ºä¸€å¹´å…è´¹ Shadowsocks æ•™ç¨‹
id: 4
date: 2018-02-25 16:54:47
urlname: google_cloud_building_ssr
tags: 
	- æ•™ç¨‹
categories: æ•™ç¨‹
cover: https://ss1.bdstatic.com/70cFvXSh_Q1YnxGkpoWK1HF6hhy/it/u=1184128736,2921380157&fm=26&gp=0.jpg
---
#### ä»¥ä¸‹å†…å®¹ï¼Œä¸éœ€è¦ç¼–ç¨‹åŸºç¡€
- éœ€è¦ç”¨åˆ°çš„å·¥å…·
    - å¯ä»¥è®¿é—® Google
    - ä¿¡ç”¨å¡ä¸€å¼ 
    - Google è´¦æˆ·
- å¦‚æœæ²¡æœ‰ç§‘å­¦ä¸Šç½‘å·¥å…·ï¼Œå¯ä»¥å…ˆä¸‹è½½ä½¿ç”¨ [è“ç¯å…è´¹ç‰ˆ](https://github.com/getlantern/forum/issues/833) ã€‚

<!--more-->

#### æ•™ç¨‹ä¸€å…±åˆ†ä¸ºå››æ­¥éª¤
1. ä½¿ç”¨ Google Cloud éƒ¨ç½²è™šæ‹Ÿæœº
2. å‡çº§VPSå†…æ ¸å¼€å¯BBR
3. æ­å»º Shadowsocks Server
4. è®¾ç½®Shadowsocks serverå¼€æœºå¯åŠ¨

### ä¸€ã€ ä½¿ç”¨ Google Cloud éƒ¨ç½²è™šæ‹Ÿæœº
#### 1.ç”³è¯·ä½¿ç”¨Google Cloud
ç”³è¯·åœ°å€ï¼š[ç‚¹å‡»æ­¤å¤„](https://cloud.google.com/free/)

![Google Cloud è¯•ç”¨](../img/Google Cloud è¯•ç”¨.jpg)

![é€‰æ‹©å›½å®¶](../img/choose country.jpg)

![](../img/å¡«å†™åœ°å€.jpg)

![å¡«å†™åœ°å€ä»¥åŠä¿¡ç”¨å¡ä¿¡æ¯](../img/å¡«å†™ä¿¡ç”¨å¡.jpg)

ç™»é™† Google è´¦æˆ·ï¼Œ**å¿…é¡»ä½¿ç”¨ä¿¡ç”¨å¡**ï¼Œè€Œä¸”ä¸èƒ½ä½¿ç”¨è™šæ‹Ÿå¡ï¼Œæ‹›å•†é“¶è¡Œã€ä¸­ä¿¡é“¶è¡Œçš„å…¨å¸ç§å¡ã€æµ¦å‘é“¶è¡Œçš„ VISA å¡å‡å¯ä»¥é€šè¿‡éªŒè¯ã€‚ç†è®ºä¸Š VISA å¡å‡å¯è·å¾—é€šè¿‡ï¼Œé€‰æ‹©ä¸­å›½åç»‘å®šä¿¡ç”¨å¡ï¼Œå¡«å†™ä¸ªäººä¿¡æ¯ï¼Œå¯å¦‚å®å¡«å†™ä¿¡ç”¨å¡è´¦å•åœ°å€ã€‚æˆåŠŸåä¼šäºæ‰£æ¬¾1åˆ€ï¼ŒéªŒè¯å¡ç‰‡åä¼šè¿”è¿˜ã€‚
GCD ç°åœ¨å…è´¹èµ é€ 300 åˆ€æœŸé™æ˜¯ä¸€å¹´ï¼Œä¹Ÿå°±æ˜¯ 300 åˆ€å’Œä¸€å¹´æ—¶é—´è°å…ˆç”¨å®Œå°±ä»¥è°ä¸ºå‡†ï¼Œ**ç»“æŸä¹‹åä¸ç‚¹ç»§ç»­ä½¿ç”¨æ—¶ä¸ä¼šæ‰£è´¹çš„**ã€‚

è·³è½¬åï¼Œå¦‚æœä½ èƒ½çœ‹åˆ°é¡µé¢é¡¶éƒ¨æœ‰ä¸€ä¸ªâ€œç¤¼ç‰© ğŸ â€ çš„å°å›¾æ ‡ï¼Œæˆ–è€…è¯´ä½ æ”¶åˆ°äº†ç›¸åº”çš„é‚®ä»¶ï¼Œè¯´æ˜è¯•ç”¨é‡‘å·²åˆ°è´¦

![è¯•ç”¨æ—¶é—´](/img/è¯•ç”¨æ—¶é—´.jpg)

ä¸Šå›¾æ˜¯æˆ‘çš„å‰©ä½™è¯•ç”¨æ—¶é—´ä»¥åŠå‰©ä½™èµ é‡‘

#### 2.ä¿®æ”¹é˜²ç«å¢™
æå‰è®¾ç½®å¥½åï¼Œåé¢è®¾ç½®å®Œ ss æœåŠ¡å°±å¯ä»¥ç›´æ¥ä½¿ç”¨äº†

è®¿é—®é“¾æ¥ï¼š[ç‚¹å‡»æ­¤å¤„](https://console.cloud.google.com/networking/firewalls/list)

æˆ–è€…åœ¨èœå•ä¸­ä¾æ¬¡ç‚¹å‡»ã€VPC ç½‘ç»œã€‘ â€“> ã€é˜²ç«å¢™è§„åˆ™ã€‘ â€“> ã€åˆ›å»ºé˜²ç«å¢™è§„åˆ™ã€‘

![åˆ›å»ºé˜²ç«å¢™è§„åˆ™.jpg](/img/åˆ›å»ºé˜²ç«å¢™è§„åˆ™.jpg)

æ›´æ”¹çº¢è‰²ç®­å¤´æŒ‡å‘çš„å‡ é¡¹ã€‚
åç§°è‡ªå·±éšæ„èµ·ï¼ŒIP åœ°å€èŒƒå›´ï¼š**0.0.0.0/0**
ç‚¹å‡»åˆ›å»ºä¼šç”Ÿæˆè§„åˆ™ï¼Œè¯·è€å¿ƒç­‰å¾…ã€‚

#### 3.è·å–é™æ€IP
è·å–é™æ€ IP å¾ˆé‡è¦ï¼Œåªæœ‰æœ‰äº†é™æ€IPï¼Œåé¢éƒ¨ç½²çš„SSæœåŠ¡æ‰èƒ½ç”¨ã€‚

è®¾ç½®åœ°å€:[ç‚¹å‡»æ­¤å¤„](https://console.cloud.google.com/networking/addresses/list?project=allow-all-ip-port-xxtlant)

æˆ–è€…åœ¨èœå•ä¸­ä¾æ¬¡ç‚¹å‡»ã€VPC ç½‘ç»œã€‘ â€“> ã€å¤–éƒ¨ IP åœ°å€ã€‘ â€“> ã€ä¿ç•™é™æ€åœ°å€ã€‘

![ä¿ç•™é™æ€åœ°å€.jpg](../img/ä¿ç•™é™æ€åœ°å€.jpg)

**åç§°è‡ªå®šä¹‰å³å¯**

PSï¼š**é™æ€ IP åªèƒ½ç”³è¯·ä¸€ä¸ªï¼ï¼ï¼**

å¤§é™†é€Ÿåº¦æœ€ä½³çš„æœºæˆ¿æ˜¯å°æ¹¾å½°åŒ–çš„æœºæˆ¿äº†ï¼Œasia-east1-cå¯¹å¤§é™†æœ€å‹å¥½
è¿˜æœ‰ä¸œäº¬äºšæ´²ä¸œåŒºï¼Œä¹Ÿå°±æ˜¯ä¸œäº¬æœºæˆ¿äº†asia-northeast1-a

#### 4.åˆ›å»ºè®¡ç®—å¼•æ“
è®¾ç½®åœ°å€:[ç‚¹å‡»æ­¤å¤„](https://console.cloud.google.com/compute/instances)

æˆ–è€…åœ¨èœå•ä¸­ä¾æ¬¡ç‚¹å‡»ã€è®¡ç®—å¼•æ“ã€‘â€“> ã€åˆ›å»ºå®ä¾‹ã€‘

![åˆ›å»ºè®¡ç®—å®ä¾‹.jpg](../img/åˆ›å»ºè®¡ç®—å®ä¾‹.jpg)

å¦‚å›¾ï¼Œæœºå™¨ç±»å‹é€‰æœ€ä¾¿å®œçš„**å¾®å‹**å°±å¤Ÿç”¨ï¼Œå¯åŠ¨ç£ç›˜é€‰**Ubuntu16.04LTS**ï¼Œæˆ‘å‚ç…§çš„æ•™ç¨‹æ˜¯ä½¿ç”¨Ubuntu1604ï¼Œæ‰€ä»¥æˆ‘é€‰æ‹©äº†è¿™ä¸ªã€‚
ç‚¹å‡»è“è‰²ç®­å¤´æŒ‡å‘çš„ ã€ç®¡ç†ã€ç£ç›˜ã€ç½‘ç»œã€SSH å¯†é’¥ã€‘ï¼Œå»è®¾ç½®ç½‘ç»œã€‚

![è®¾ç½®ç½‘ç»œ.jpg](../img/è®¾ç½®ç½‘ç»œ.jpg)

![è®¾ç½®é™æ€åœ°å€.jpg](../img/è®¾ç½®é™æ€åœ°å€.jpg)

æŒ‰å›¾æ‰€ç¤ºï¼Œç‚¹å‡» ä¸»è¦å†…éƒ¨ IP çš„ä¿ç•™é™æ€ IP åœ°å€ï¼Œç„¶åé€‰æ‹©åˆšæ‰åˆ›å»ºçš„é™æ€ IP å³å¯ã€‚ç‚¹å‡»åˆ›å»ºå³å¯å®Œæˆã€‚
ç­‰å¾…ä¸€ä¼šåï¼Œå‡ºç°ä¸‹å›¾æ‰€ç¤ºï¼Œå³å·²ç»å®Œæˆåˆ›å»ºã€‚

![å®ä¾‹.jpg](../img/å®ä¾‹.jpg)

è‡³æ­¤ï¼Œç¬¬ä¸€æ­¥å·²ç»å®Œæˆã€‚

### äºŒã€å‡çº§VPSå†…æ ¸å¼€å¯BBR(è¿™ä¸€æ­¥ï¼Œæˆ‘ä¸æ‡‚ï¼Œæ˜¯å‚è€ƒæœåˆ°çš„æ•™ç¨‹æ¥è®¾å®šçš„)

ç”±äºä¼—æ‰€å‘¨çŸ¥çš„åŸå› ï¼Œå•çº¯éƒ¨ç½²å®ŒshadowsocksæœåŠ¡ä¹‹åé€Ÿåº¦éƒ½ä¸ä¼šå¤ªç†æƒ³ï¼Œå³ä½¿ä½ é€‰æ‹©çš„æ˜¯å°æ¹¾ã€æ—¥æœ¬è¿™ç§å¾ˆå¥½çš„çº¿è·¯ï¼Œä¾ç„¶ä¼šå­˜åœ¨ä¸¢åŒ…å’Œä¸ç¨³å®šçš„æƒ…å†µã€‚

ç‚¹å‡»ä¸Šå›¾åˆ›å»ºå®ä¾‹å®Œæˆåï¼Œå³è¾¹çš„ SSHã€‚ä¼šå¼¹å‡ºä¸€ä¸ªé¡µé¢ï¼Œå¦‚ä¸‹å›¾ï¼š

![SSH é¡µé¢.jpg](../img/SSH é¡µé¢.jpg)

#### å‡†å¤‡å·¥ä½œ
è¿›å…¥ ssh åï¼Œå…ˆè·å– root æƒé™

```
sudo â€“i
```
æ›´æ–°ç³»ç»Ÿï¼Œä¸¤æ­¥åˆ†å¼€æ‰§è¡Œï¼Œç¬¬äºŒæ­¥è€—æ—¶ä¹…ä¸€äº›

```
apt update
apt upgrade
```
æŸ¥çœ‹å½“å‰å†…æ ¸

```
uname â€“a
```
#### å¯ç”¨BBR
å†™å…¥é…ç½® ä¸¤æ­¥åˆ†å¼€æ‰§è¡Œ

```
echo "net.core.default_qdisc=fq" >> /etc/sysctl.conf

echo "net.ipv4.tcp_congestion_control=bbr" >> /etc/sysctl.conf
```
é…ç½®ç”Ÿæ•ˆ

```
sysctl -p
```
æ£€éªŒ

```
lsmod | grep bbr
```
çœ‹åˆ°æ˜¾ç¤º`tcp_bbr 20480 xx ` è¯´æ˜å·²ç»æˆåŠŸå¼€å¯ BBRã€‚**ä¸éœ€è¦é‡æ–°å¯åŠ¨**

è‡³æ­¤ï¼Œç¬¬äºŒæ­¥å·²ç»ç»“æŸï¼Œæ¥ä¸‹æ¥ç›´æ¥å¼€å§‹åœ¨è™šæ‹Ÿæœºéƒ¨ç½² SS æœåŠ¡ã€‚

### ä¸‰ã€æ­å»º Shadowsocks Server
é¦–å…ˆæ›´æ–°ä¸€ä¸‹ apt-get è½¯ä»¶åŒ…

```
sudo apt-get update
```
ç„¶åé€šè¿‡ apt-get å®‰è£… python-pip

```
sudo apt-get install python-pip
```
å®Œæˆä¹‹åä½¿ç”¨ pip å®‰è£… shadowsocks æœåŠ¡

```
sudo pip install shadowsocks
```
![å®‰è£…Shadowsocks.jpg](../img/å®‰è£…Shadowsocks.jpg)

è¯´æ˜å®‰è£…æˆåŠŸäº†ã€‚

ç„¶åæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ª shadowsocks server çš„é…ç½®æ–‡ä»¶ï¼Œå¯ä»¥ç›´æ¥å»ºåœ¨å½“å‰ç”¨æˆ·ç›®å½•ä¸‹

```
sudo vim /etc/ss-conf.json
```
å›è½¦ä¹‹åä¼šè¿›å…¥è¿™ä¸ªåˆ›å»ºçš„æ–‡ä»¶ï¼Œ
æŒ‰é”®ç›˜ä¸Šçš„ i é”®ä¼šè¿›å…¥ç¼–è¾‘ï¼Œç„¶åæŠŠä¸‹é¢çš„å†…å®¹è¾“å…¥è¿›å»ã€‚
æŒ‰ESCé”®ä¼šå‘ç°å·¦ä¸‹è§’çš„insertæ¶ˆå¤±ï¼Œ
ä½¿ç”¨ç»„åˆé”® **shift åŠ  ï¼š** ï¼Œè¿™ä¸ªç»„åˆé”®å·¦ä¸‹è§’å‡ºç°**ï¼š**ï¼Œç„¶åè¾“å…¥ **wq** å›è½¦å°±ä¿å­˜é€€å‡ºæ–‡ä»¶ã€‚

```
{
"server":"0.0.0.0",
"server_port":000,
"local_address":"127.0.0.1",
"local_port":1080,
"password":"123456",
"timeout":600,
"method":"aes-256-cfb"
}
```
å°†ä¸Šé¢çš„å†…å®¹å¤åˆ¶åˆ°åˆ›å»ºçš„æ–‡ä»¶é‡Œå°±å¯ä»¥äº†ã€‚

<font size =4>**æ³¨æ„**
1. ä»£ç çš„å…¨éƒ¨å†…å®¹å¿…é¡»ä¸º**è‹±æ–‡åŠè§’è¾“å…¥**ï¼Œ
2. **server_port**ä¸**password**åé¢çš„æ•°å­—å†…å®¹**è¯·è‡ªå·±è®¾å®š**ï¼Œè¿™ä¸¤ä¸ªæ˜¯ä½ ä¹‹ååœ¨shadowsockså®¢æˆ·ç«¯ä¸Šé…ç½®ä½¿ç”¨çš„**ç«¯å£å’Œå¯†ç **ã€‚</font>

æœ€åç”¨è¿™ä¸ªé…ç½®æ–‡ä»¶å¯åŠ¨ shadowsocks æœåŠ¡

```
sudo ssserver -c /etc/ss-conf.json -d start
```

### å››ã€å¼€å¯ Shadowsocks Server å¼€æœºå¯åŠ¨
æœåŠ¡å™¨å¯èƒ½ä¼šè‡ªåŠ¨é‡å¯ï¼Œè¿™æ ·çš„è¯å°±éœ€è¦æ¯æ¬¡æ‰‹åŠ¨å¼€å¯SSæœåŠ¡ï¼Œå¾ˆéº»çƒ¦è€Œä¸”è¿˜ä¼šé‡åˆ°è¦ç”¨æ¢¯å­ä½†æ˜¯æ¢¯å­åœ¨å¢™å¤–çš„è¿™ç§å›°å¢ƒï¼Œæ€ä¹ˆåŠå‘¢ï¼Ÿé‚£ä¹ˆæˆ‘ä»¬è¿›å…¥ç¬¬å››æ­¥ï¼Œå†™è„šæœ¬è®©ç³»ç»Ÿå¼€æœºåè‡ªåŠ¨å¯åŠ¨ssæœåŠ¡ã€‚

åˆ›å»ºè„šæœ¬ /etc/init.d/shadowsocks
```
sudo vim /etc/init.d/shadowsocks
```

è¿›å…¥æ–‡ä»¶åæ·»åŠ ä»¥ä¸‹å†…å®¹,æ–¹æ³•ä¸å‰é¢åˆ›å»ºss-conf.jsonè¿™ä¸ªæ–‡ä»¶ä¸€æ ·ï¼Œä½¿ç”¨é”®ç›˜å­—æ¯ **i** é”®ã€**shif åŠ  ï¼š**ã€**wq**å›è½¦ä¿å­˜ç­‰ç­‰

```
#!/bin/sh
### BEGIN INIT INFO
# Provides: shadowsocks
# Required-Start: $remote_fs $syslog
# Required-Stop: $remote_fs $syslog
# Default-Start: 2 3 4 5
# Default-Stop: 0 1 6
# Short-Description: start shadowsocks
# Description: start shadowsocks
### END INIT INFO
start(){
ã€€ã€€ã€€ssserver -c /etc/ss-conf.json -d start
}
stop(){
ã€€ã€€ã€€ssserver -c /etc/ss-conf.json -d stop
}
case â€œ$1â€ in
start)
ã€€ã€€ã€€start
ã€€ã€€ã€€;;
stop)
ã€€ã€€ã€€stop
ã€€ã€€ã€€;;
reload)
ã€€ã€€ã€€stop
ã€€ã€€ã€€start
ã€€ã€€ã€€;;
*)
ã€€ã€€ã€€echo â€œUsage: $0 {start|reload|stop}â€
ã€€ã€€ã€€exit 1
ã€€ã€€ã€€;;
esac
```
ç„¶åå¢åŠ è¿™ä¸ªæ–‡ä»¶çš„å¯æ‰§è¡Œæƒé™

```
sudo chmod +x /etc/init.d/shadowsocks
```
åˆ›å»ºæ–‡ä»¶ /etc/init/shadowsocks.conf

```
sudo vim /etc/init/shadowsocks.conf
```
å†…å®¹ç›´æ¥å¤åˆ¶å¦‚ä¸‹

```
start on (runlevel [2345])stop on (runlevel [016])pre-start script
/etc/init.d/shadowsocks start
end script

post-stop script
/etc/init.d/shadowsocks stop
end script
```
æ‰§è¡Œ

```
sudo update-rc.d shadowsocks defaults
```
ç„¶åå°±æ·»åŠ åˆ°å¼€æœºå¯åŠ¨ä¸­äº†
æœ€åä½ å¯ä»¥ **Reboot** æµ‹è¯•ä¸€ä¸‹çœ‹æ˜¯å¦æˆåŠŸï¼Œè‹¥æœªæˆåŠŸå°±checkä¸€ä¸‹ç¬¬å››æ­¥å“ªé‡Œæœ‰é—®é¢˜ã€‚

è‡³æ­¤æ­å»ºå·²ç»å…¨éƒ¨å®Œæˆäº†ã€‚

![Youtubeæµ‹è¯•.jpg](../img/Youtubeæµ‹è¯•.jpg)

### SSR å®¢æˆ·ç«¯ [ä¸‹è½½åœ°å€](http://shadowsocks.org/en/download/clients.html)

ç›´æ¥ä¸‹è½½æ–‡ä»¶

[Mac ç‰ˆ](/img/ShadowsocksX-NG.1.7.1.zip)

[Android](/img/com.github.shadowsocks.apk)
<!--more-->